define(["jquery","../utils"],function(f,d){function e(a,c,b){this.$dropdownParent=b.get("dropdownParent")||f(document.body);a.call(this,c,b)}e.prototype.bind=function(b,j,a){var c=this;var i=false;b.call(this,j,a);j.on("open",function(){c._showDropdown();c._attachPositioningHandler(j);if(!i){i=true;j.on("results:all",function(){c._positionDropdown();c._resizeDropdown()});j.on("results:append",function(){c._positionDropdown();c._resizeDropdown()})}});j.on("close",function(){c._hideDropdown();c._detachPositioningHandler(j)});this.$dropdownContainer.on("mousedown",function(g){g.stopPropagation()})};e.prototype.destroy=function(a){a.call(this);this.$dropdownContainer.remove()};e.prototype.position=function(c,b,a){b.attr("class",a.attr("class"));b.removeClass("select2");b.addClass("select2-container--open");b.css({position:"absolute",top:-999999});this.$container=a};e.prototype.render=function(c){var a=f("<span></span>");var b=c.call(this);a.append(b);this.$dropdownContainer=a;return a};e.prototype._hideDropdown=function(a){this.$dropdownContainer.detach()};e.prototype._attachPositioningHandler=function(a,n){var m=this;var k="scroll.select2."+n.id;var b="resize.select2."+n.id;var c="orientationchange.select2."+n.id;var l=this.$container.parents().filter(d.hasScroll);l.each(function(){d.StoreData(this,"select2-scroll-position",{x:f(this).scrollLeft(),y:f(this).scrollTop()})});l.on(k,function(g){var h=d.GetData(this,"select2-scroll-position");f(this).scrollTop(h.y)});f(window).on(k+" "+b+" "+c,function(g){m._positionDropdown();m._resizeDropdown()})};e.prototype._detachPositioningHandler=function(a,l){var j="scroll.select2."+l.id;var b="resize.select2."+l.id;var c="orientationchange.select2."+l.id;var k=this.$container.parents().filter(d.hasScroll);k.off(j);f(window).off(j+" "+b+" "+c)};e.prototype._positionDropdown=function(){var w=f(window);var a=this.$dropdown.hasClass("select2-dropdown--above");var x=this.$dropdown.hasClass("select2-dropdown--below");var q=null;var v=this.$container.offset();v.bottom=v.top+this.$container.outerHeight(false);var y={height:this.$container.outerHeight(false)};y.top=v.top;y.bottom=v.top+y.height;var b={height:this.$dropdown.outerHeight(false)};var s={top:w.scrollTop(),bottom:w.scrollTop()+w.height()};var t=s.top<(v.top-b.height);var r=s.bottom>(v.bottom+b.height);var u={left:v.left,top:y.bottom};var c=this.$dropdownParent;if(c.css("position")==="static"){c=c.offsetParent()}var z=c.offset();u.top-=z.top;u.left-=z.left;if(!a&&!x){q="below"}if(!r&&t&&!a){q="above"}else{if(!t&&r&&a){q="below"}}if(q=="above"||(a&&q!=="below")){u.top=y.top-z.top-b.height}if(q!=null){this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+q);this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+q)}this.$dropdownContainer.css(u)};e.prototype._resizeDropdown=function(){var a={width:this.$container.outerWidth(false)+"px"};if(this.options.get("dropdownAutoWidth")){a.minWidth=a.width;a.position="relative";a.width="auto"}this.$dropdown.css(a)};e.prototype._showDropdown=function(a){this.$dropdownContainer.appendTo(this.$dropdownParent);this._positionDropdown();this._resizeDropdown()};return e});