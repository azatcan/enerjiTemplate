define(["jquery"],function(c){function d(s,p,m){var b=m.get("tags");var r=m.get("createTag");if(r!==undefined){this.createTag=r}var q=m.get("insertTag");if(q!==undefined){this.insertTag=q}s.call(this,p,m);if(c.isArray(b)){for(var n=0;n<b.length;n++){var a=b[n];var o=this._normalizeItem(a);var t=this.option(o);this.$element.append(t)}}}d.prototype.query=function(i,h,a){var j=this;this._removeOldTags();if(h.term==null||h.page!=null){i.call(this,h,a);return}function b(u,y){var t=u.results;for(var g=0;g<t.length;g++){var f=t[g];var w=(f.children!=null&&!b({results:f.children},true));var e=(f.text||"").toUpperCase();var x=(h.term||"").toUpperCase();var v=e===x;if(v||w){if(y){return false}u.data=t;a(u);return}}if(y){return true}var A=j.createTag(h);if(A!=null){var z=j.option(A);z.attr("data-select2-tag",true);j.addOptions([z]);j.insertTag(t,A)}u.results=t;a(u)}i.call(this,h,b)};d.prototype.createTag=function(b,a){var f=c.trim(a.term);if(f===""){return null}return{id:f,text:f}};d.prototype.insertTag=function(b,a,f){a.unshift(f)};d.prototype._removeOldTags=function(a){var b=this._lastTag;var f=this.$element.find("option[data-select2-tag]");f.each(function(){if(this.selected){return}c(this).remove()})};return d});