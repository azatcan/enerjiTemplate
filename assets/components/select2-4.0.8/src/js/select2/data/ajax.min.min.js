define(["./array","../utils","jquery"],function(g,h,e){function f(b,a){this.ajaxOptions=this._applyDefaults(a.get("ajax"));if(this.ajaxOptions.processResults!=null){this.processResults=this.ajaxOptions.processResults}f.__super__.constructor.call(this,b,a)}h.Extend(f,g);f.prototype._applyDefaults=function(b){var a={data:function(c){return e.extend({},c,{q:c.term})},transport:function(c,d,k){var l=e.ajax(c);l.then(d);l.fail(k);return l}};return e.extend({},a,b,true)};f.prototype.processResults=function(a){return a};f.prototype.query=function(b,a){var c=[];var l=this;if(this._request!=null){if(e.isFunction(this._request.abort)){this._request.abort()}this._request=null}var k=e.extend({type:"GET"},this.ajaxOptions);if(typeof k.url==="function"){k.url=k.url.call(this.$element,b)}if(typeof k.data==="function"){k.data=k.data.call(this.$element,b)}function d(){var i=k.transport(k,function(j){var n=l.processResults(j,b);if(l.options.get("debug")&&window.console&&console.error){if(!n||!n.results||!e.isArray(n.results)){console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")}}a(n)},function(){if("status" in i&&(i.status===0||i.status==="0")){return}l.trigger("results:message",{message:"errorLoading"})});l._request=i}if(this.ajaxOptions.delay&&b.term!=null){if(this._queryTimeout){window.clearTimeout(this._queryTimeout)}this._queryTimeout=window.setTimeout(d,this.ajaxOptions.delay)}else{d()}};return f});