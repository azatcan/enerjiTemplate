define(["./base","../utils","jquery"],function(f,g,h){function e(b,a){this.$element=b;this.options=a;e.__super__.constructor.call(this)}g.Extend(e,f);e.prototype.current=function(a){var b=[];var c=this;this.$element.find(":selected").each(function(){var d=h(this);var j=c.item(d);b.push(j)});a(b)};e.prototype.select=function(b){var c=this;b.selected=true;if(h(b.element).is("option")){b.element.selected=true;this.$element.trigger("change");return}if(this.$element.prop("multiple")){this.current(function(n){var l=[];b=[b];b.push.apply(b,n);for(var m=0;m<b.length;m++){var d=b[m].id;if(h.inArray(d,l)===-1){l.push(d)}}c.$element.val(l);c.$element.trigger("change")})}else{var a=b.id;this.$element.val(a);this.$element.trigger("change")}};e.prototype.unselect=function(a){var b=this;if(!this.$element.prop("multiple")){return}a.selected=false;if(h(a.element).is("option")){a.element.selected=false;this.$element.trigger("change");return}this.current(function(l){var d=[];for(var k=0;k<l.length;k++){var c=l[k].id;if(c!==a.id&&h.inArray(c,d)===-1){d.push(c)}}b.$element.val(d);b.$element.trigger("change")})};e.prototype.bind=function(c,a){var b=this;this.container=c;c.on("select",function(d){b.select(d.data)});c.on("unselect",function(d){b.unselect(d.data)})};e.prototype.destroy=function(){this.$element.find("*").each(function(){g.RemoveData(this)})};e.prototype.query=function(b,a){var c=[];var d=this;var j=this.$element.children();j.each(function(){var i=h(this);if(!i.is("option")&&!i.is("optgroup")){return}var n=d.item(i);var m=d.matches(b,n);if(m!==null){c.push(m)}});a({results:c})};e.prototype.addOptions=function(a){g.appendMany(this.$element,a)};e.prototype.option=function(c){var d;if(c.children){d=document.createElement("optgroup");d.label=c.text}else{d=document.createElement("option");if(d.textContent!==undefined){d.textContent=c.text}else{d.innerText=c.text}}if(c.id!==undefined){d.value=c.id}if(c.disabled){d.disabled=true}if(c.selected){d.selected=true}if(c.title){d.title=c.title}var b=h(d);var a=this._normalizeItem(c);a.element=d;g.StoreData(d,"data",a);return b};e.prototype.item=function(c){var d={};d=g.GetData(c[0],"data");if(d!=null){return d}if(c.is("option")){d={id:c.val(),text:c.text(),disabled:c.prop("disabled"),selected:c.prop("selected"),title:c.prop("title")}}else{if(c.is("optgroup")){d={text:c.prop("label"),children:[],title:c.prop("title")};var n=c.children("option");var m=[];for(var a=0;a<n.length;a++){var l=h(n[a]);var b=this.item(l);m.push(b)}d.children=m}}d=this._normalizeItem(d);d.element=c[0];g.StoreData(c[0],"data",d);return d};e.prototype._normalizeItem=function(b){if(b!==Object(b)){b={id:b,text:b}}b=h.extend({},{text:""},b);var a={selected:false,disabled:false};if(b.id!=null){b.id=b.id.toString()}if(b.text!=null){b.text=b.text.toString()}if(b._resultId==null&&b.id&&this.container!=null){b._resultId=this.generateResultId(this.container,b)}return h.extend({},a,b)};e.prototype.matches=function(a,c){var b=this.options.get("matcher");return b(a,c)};return e});