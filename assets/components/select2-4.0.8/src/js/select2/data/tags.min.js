define(["jquery"],function(b){function a(d,g,j){var k=j.get("tags");var e=j.get("createTag");if(e!==undefined){this.createTag=e}var f=j.get("insertTag");if(f!==undefined){this.insertTag=f}d.call(this,g,j);if(b.isArray(k)){for(var i=0;i<k.length;i++){var l=k[i];var h=this._normalizeItem(l);var c=this.option(h);this.$element.append(c)}}}a.prototype.query=function(d,e,g){var c=this;this._removeOldTags();if(e.term==null||e.page!=null){d.call(this,e,g);return}function f(n,j){var o=n.results;for(var p=0;p<o.length;p++){var q=o[p];var l=(q.children!=null&&!f({results:q.children},true));var r=(q.text||"").toUpperCase();var k=(e.term||"").toUpperCase();var m=r===k;if(m||l){if(j){return false}n.data=o;g(n);return}}if(j){return true}var s=c.createTag(e);if(s!=null){var h=c.option(s);h.attr("data-select2-tag",true);c.addOptions([h]);c.insertTag(o,s)}n.results=o;g(n)}d.call(this,e,f)};a.prototype.createTag=function(d,e){var c=b.trim(e.term);if(c===""){return null}return{id:c,text:c}};a.prototype.insertTag=function(d,e,c){e.unshift(c)};a.prototype._removeOldTags=function(e){var d=this._lastTag;var c=this.$element.find("option[data-select2-tag]");c.each(function(){if(this.selected){return}b(this).remove()})};return a});