define(["jquery","../utils"],function(f,d){function e(a,c,b){this._currentData=[];this._valueSeparator=b.get("valueSeparator")||",";if(c.prop("type")==="hidden"){if(b.get("debug")&&console&&console.warn){console.warn("Select2: Using a hidden input with Select2 is no longer supported and may stop working in the future. It is recommended to use a `<select>` element instead.")}}a.call(this,c,b)}e.prototype.current=function(l,a){function m(g,i){var h=[];if(g.selected||f.inArray(g.id,i)!==-1){g.selected=true;h.push(g)}else{g.selected=false}if(g.children){h.push.apply(h,m(g.children,i))}return h}var k=[];for(var b=0;b<this._currentData.length;b++){var c=this._currentData[b];k.push.apply(k,m(c,this.$element.val().split(this._valueSeparator)))}a(k)};e.prototype.select=function(c,a){if(!this.options.get("multiple")){this.current(function(h){f.map(h,function(g){g.selected=false})});this.$element.val(a.id);this.$element.trigger("change")}else{var b=this.$element.val();b+=this._valueSeparator+a.id;this.$element.val(b);this.$element.trigger("change")}};e.prototype.unselect=function(b,a){var c=this;a.selected=false;this.current(function(l){var n=[];for(var k=0;k<l.length;k++){var m=l[k];if(a.id==m.id){continue}n.push(m.id)}c.$element.val(n.join(c._valueSeparator));c.$element.trigger("change")})};e.prototype.query=function(o,b,a){var n=[];for(var c=0;c<this._currentData.length;c++){var l=this._currentData[c];var m=this.matches(b,l);if(m!==null){n.push(m)}}a({results:n})};e.prototype.addOptions=function(a,c){var b=f.map(c,function(h){return d.GetData(h[0],"data")});this._currentData.push.apply(this._currentData,b)};return e});