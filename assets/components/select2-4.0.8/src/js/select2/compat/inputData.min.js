define(["jquery","../utils"],function(c,b){function a(f,d,e){this._currentData=[];this._valueSeparator=e.get("valueSeparator")||",";if(d.prop("type")==="hidden"){if(e.get("debug")&&console&&console.warn){console.warn("Select2: Using a hidden input with Select2 is no longer supported and may stop working in the future. It is recommended to use a `<select>` element instead.")}}f.call(this,d,e)}a.prototype.current=function(f,j){function e(l,d){var k=[];if(l.selected||c.inArray(l.id,d)!==-1){l.selected=true;k.push(l)}else{l.selected=false}if(l.children){k.push.apply(k,e(l.children,d))}return k}var g=[];for(var i=0;i<this._currentData.length;i++){var h=this._currentData[i];g.push.apply(g,e(h,this.$element.val().split(this._valueSeparator)))}j(g)};a.prototype.select=function(d,f){if(!this.options.get("multiple")){this.current(function(g){c.map(g,function(h){h.selected=false})});this.$element.val(f.id);this.$element.trigger("change")}else{var e=this.$element.val();e+=this._valueSeparator+f.id;this.$element.val(e);this.$element.trigger("change")}};a.prototype.unselect=function(e,f){var d=this;f.selected=false;this.current(function(i){var g=[];for(var j=0;j<i.length;j++){var h=i[j];if(f.id==h.id){continue}g.push(h.id)}d.$element.val(g.join(d._valueSeparator));d.$element.trigger("change")})};a.prototype.query=function(e,j,k){var f=[];for(var i=0;i<this._currentData.length;i++){var h=this._currentData[i];var g=this.matches(j,h);if(g!==null){f.push(g)}}k({results:f})};a.prototype.addOptions=function(f,d){var e=c.map(d,function(g){return b.GetData(g[0],"data")});this._currentData.push.apply(this._currentData,e)};return a});