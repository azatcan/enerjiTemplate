module("Data adaptor - Tokenizer");test("triggers the select event",function(y){y.expect(2);var v=require("select2/data/select");var p=require("select2/data/tokenizer");var u=require("select2/data/tags");var q=require("select2/options");var r=require("select2/utils");var s=require("jquery");var z=r.Decorate(r.Decorate(v,u),p);var w=s("#qunit-fixture .single");var n=new q({tags:true,tokenSeparators:[","]});var x=new MockContainer();x.dropdown=x.selection={};var o=s("<div></div>");var t=new z(w,n);t.bind(x,o);t.on("select",function(){y.ok(true,"The select event should be triggered")});t.query({term:"first,second"},function(){y.ok(true,"The callback should have succeeded")})});test("createTag can return null",function(y){y.expect(3);var v=require("select2/data/select");var p=require("select2/data/tokenizer");var u=require("select2/data/tags");var q=require("select2/options");var r=require("select2/utils");var s=require("jquery");var z=r.Decorate(r.Decorate(v,u),p);var w=s("#qunit-fixture .single");var n=new q({tags:true,tokenSeparators:[","],createTag:function(){y.ok(true,"createTag should have been called");return null}});var x=new MockContainer();x.dropdown=x.selection={};var o=s("<div></div>");var t=new z(w,n);t.bind(x,o);t.on("select",function(a){if(a.data==null){y.ok(false,"Null data should never be selected")}});t.query({term:"first,second"},function(){y.ok(true,"The callback should have succeeded")})});test("createTag returning null does not cut the term",function(y){y.expect(4);var v=require("select2/data/select");var p=require("select2/data/tokenizer");var u=require("select2/data/tags");var q=require("select2/options");var r=require("select2/utils");var s=require("jquery");var z=r.Decorate(r.Decorate(v,u),p);var w=s("#qunit-fixture .single");var n=new q({tags:true,tokenSeparators:[",",'"'],createTag:function(a){var c=a.term;if(c.length===0){return null}if(c==='"'){return null}if(c[0]==='"'&&c[c.length-1]!=='"'){return null}var b=c.substr(1,c.length-2);return{id:c,text:b}}});var x=new MockContainer();x.dropdown=x.selection={};var o=s("<div></div>");var t=new z(w,n);t.bind(x,o);t.on("select",function(a){y.ok(a.data,"Data should not be null");y.equal(a.data.id,'"first, second"',"The id should have the quotes");y.equal(a.data.text,"first, second","The text should not have the quotes")});t.query({term:'"first, second",abc'},function(){y.ok(true,"The callback should have succeeded")})});test("works with multiple tokens given",function(y){y.expect(4);var v=require("select2/data/select");var p=require("select2/data/tokenizer");var u=require("select2/data/tags");var q=require("select2/options");var r=require("select2/utils");var s=require("jquery");var z=r.Decorate(r.Decorate(v,u),p);var w=s("#qunit-fixture .multiple");var n=new q({tags:true,tokenSeparators:[","]});var x=new MockContainer();x.dropdown=x.selection={};var o=s("<div></div>");var t=new z(w,n);t.bind(x,o);t.on("select",function(){y.ok(true,"The select event should be triggered")});t.query({term:"first,second,third"},function(){y.ok(true,"The callback should have succeeded")});y.equal(w.children("option").length,3,"The two new tags should have been created")});